<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WhyTab</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%234E7A65'/%3E%3C/svg%3E">
  <link rel="stylesheet" href="tabstash.css">
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1 class="logo">WhyTab</h1>
      </div>

      <nav class="sidebar-nav">
        <button class="nav-item active" data-view="all">
          <svg width="15" height="15" viewBox="0 0 15 15" fill="none"><rect x="2" y="2" width="11" height="11" rx="2" stroke="currentColor" stroke-width="1.2" fill="none"/><path d="M2 5.5H13" stroke="currentColor" stroke-width="1.2"/></svg>
          All Tabs
          <span id="nav-all-count" class="nav-count"></span>
        </button>
      </nav>

      <!-- Save open tabs link -->
      <button id="save-tabs-btn" class="sidebar-save-link">
        <svg width="14" height="14" viewBox="0 0 13 13" fill="none"><path d="M6.5 2.5V10.5M2.5 6.5H10.5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
        Save & close tabs
      </button>

      <div class="sidebar-divider"></div>

      <div id="sidebar-collections" class="sidebar-collections"></div>

      <div class="sidebar-footer">
        <div id="sidebar-system" class="sidebar-system"></div>
        <button id="nav-archived" class="nav-item nav-item-muted nav-item-archived" data-view="archived">
          Archived
        </button>
        <button id="new-collection-btn" class="nav-item nav-item-muted">
          <svg width="15" height="15" viewBox="0 0 15 15" fill="none"><path d="M7.5 3V12M3 7.5H12" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
          New collection
        </button>
        <button id="settings-btn" class="nav-item nav-item-muted">
          <svg width="15" height="15" viewBox="0 0 15 15" fill="none"><circle cx="7.5" cy="7.5" r="2" stroke="currentColor" stroke-width="1.1" fill="none"/><path d="M7.5 1.5V3.5M7.5 11.5V13.5M1.5 7.5H3.5M11.5 7.5H13.5M3.3 3.3L4.7 4.7M10.3 10.3L11.7 11.7M11.7 3.3L10.3 4.7M4.7 10.3L3.3 11.7" stroke="currentColor" stroke-width="1.1" stroke-linecap="round"/></svg>
          Settings
        </button>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <header class="main-header">
        <div class="search-bar">
          <svg class="search-icon" width="16" height="16" viewBox="0 0 15 15" fill="none">
            <circle cx="6.5" cy="6.5" r="4.5" stroke="currentColor" stroke-width="1.3"/>
            <line x1="10" y1="10" x2="13.5" y2="13.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
          </svg>
          <input type="text" id="search" placeholder="Search tabs..." autocomplete="off" spellcheck="false">
          <button id="search-clear-btn" class="search-clear-btn hidden" type="button" aria-label="Clear search">&times;</button>
          <kbd class="search-kbd">/</kbd>
          <div id="search-panel" class="search-panel hidden">
            <div class="search-panel-section">
              <div class="search-panel-title-row">
                <div class="search-panel-title">Recent searches</div>
                <button id="clear-search-history" class="search-history-clear hidden" type="button">Clear search history</button>
              </div>
              <div id="recent-searches" class="recent-searches"></div>
            </div>
          </div>
        </div>
        <div id="view-actions" class="view-actions hidden">
          <button id="collapse-all-btn" class="view-action-btn">Collapse all</button>
          <button id="expand-all-btn" class="view-action-btn">Expand all</button>
          <span id="collection-sort-divider" class="view-actions-divider hidden" aria-hidden="true"></span>
          <details id="collection-sort-menu" class="inline-menu sort-menu hidden">
            <summary class="view-action-btn sort-menu-btn" title="Sort collections">
              Sort: <span id="collection-sort-label">Newest</span>
            </summary>
            <div class="inline-menu-panel sort-menu-panel">
              <button class="inline-menu-item collection-sort-item" data-sort="newest" role="menuitemradio">Newest first</button>
              <button class="inline-menu-item collection-sort-item" data-sort="oldest" role="menuitemradio">Oldest first</button>
              <button class="inline-menu-item collection-sort-item" data-sort="az" role="menuitemradio">Alphabetical (A–Z)</button>
              <button class="inline-menu-item collection-sort-item" data-sort="za" role="menuitemradio">Alphabetical (Z–A)</button>
            </div>
          </details>
        </div>
      </header>

      <!-- Filter pill (shown contextually) -->
      <div id="filter-bar" class="filter-bar hidden">
        <span id="filter-pill" class="filter-pill">
          <span id="filter-text"></span>
          <button id="filter-clear" class="filter-clear">&times;</button>
        </span>
      </div>

      <!-- View title -->
      <div class="view-header">
        <h2 id="view-title" class="view-title">All Tabs</h2>
        <span id="view-count" class="view-count"></span>
      </div>

      <!-- Content -->
      <div id="content" class="content"></div>

      <!-- Empty state -->
      <div id="empty-state" class="empty-state hidden">
        <div class="empty-icon">
          <svg width="32" height="32" viewBox="0 0 40 40" fill="none">
            <rect x="5" y="9" width="30" height="22" rx="3" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <path d="M5 15H35" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="10" cy="12" r="1" fill="currentColor"/>
            <circle cx="14" cy="12" r="1" fill="currentColor"/>
            <circle cx="18" cy="12" r="1" fill="currentColor"/>
          </svg>
        </div>
        <p class="empty-title" id="empty-title">Save your first session</p>
        <p class="empty-desc" id="empty-desc">WhyTab turns your open tabs into saved sessions you can revisit anytime.</p>
        <p class="empty-sub" id="empty-sub">Use the button below or click "Save open tabs" in the sidebar.</p>
        <button class="empty-cta-btn" id="empty-cta-btn">Save your first session</button>
      </div>
    </main>
  </div>

  <!-- Move modal -->
  <div id="move-modal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog">
      <div class="modal-header">
        <h3>Move to collection</h3>
        <button class="modal-close" id="move-close-btn">&times;</button>
      </div>
      <div id="move-list" class="modal-body"></div>
    </div>
  </div>

  <!-- Inline input modal -->
  <div id="inline-input-modal" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop modal-backdrop-soft"></div>
    <div class="modal-dialog modal-compact">
      <div class="inline-input-modal-body">
        <h3 id="inline-input-modal-title">New collection</h3>
        <input id="inline-input-modal-input" class="inline-input-modal-field" type="text" placeholder="Collection name" autocomplete="off" spellcheck="false">
        <div class="inline-input-modal-actions">
          <button id="inline-input-modal-confirm" class="inline-input-modal-confirm">Create</button>
          <button id="inline-input-modal-cancel" class="inline-input-modal-cancel">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings overlay -->
  <div id="settings-overlay" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog modal-wide">
      <div class="modal-header">
        <h3>Settings</h3>
        <button class="modal-close" id="settings-close-btn">&times;</button>
      </div>
      <div class="modal-body settings-body">
        <div class="setting-group">
          <div class="setting-row">
            <div class="setting-info">
              <div class="setting-label">Show item URLs</div>
              <div class="setting-desc">Display each tab URL directly in list rows.</div>
            </div>
            <label class="setting-switch">
              <input id="setting-show-item-urls" type="checkbox">
              <span class="slider"></span>
            </label>
          </div>
        </div>
        <div class="setting-group">
          <div class="setting-row">
            <div class="setting-info">
              <div class="setting-label">Context-aware auto titles</div>
              <div class="setting-desc">Generate collection names from tab context (domains/keywords) instead of only date + time of day.</div>
            </div>
            <label class="setting-switch">
              <input id="setting-contextual-auto-titles" type="checkbox">
              <span class="slider"></span>
            </label>
          </div>
        </div>
        <div class="setting-group">
          <div class="setting-row">
            <div class="setting-info">
              <div class="setting-label">Show sort control</div>
              <div class="setting-desc">Display a sort option in the toolbar to reorder collections.</div>
            </div>
            <label class="setting-switch">
              <input id="setting-show-sort-control" type="checkbox">
              <span class="slider"></span>
            </label>
          </div>
        </div>
        <div class="setting-group">
          <div class="setting-row">
            <div class="setting-info">
              <div class="setting-label">Auto-archive inactive sessions</div>
              <div class="setting-desc">Automatically archive unnamed sessions after 14 days of inactivity.</div>
            </div>
            <label class="setting-switch">
              <input id="setting-auto-archive-inactive" type="checkbox">
              <span class="slider"></span>
            </label>
          </div>
        </div>
        <div class="setting-group">
          <div class="setting-row">
            <div class="setting-info">
              <div class="setting-label">Export data</div>
            </div>
            <button id="setting-export-btn" class="setting-action-btn">Export JSON</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Command palette -->
  <div id="command-palette" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog palette-dialog">
      <input type="text" id="palette-input" class="palette-input" placeholder="Type a command..." autocomplete="off" spellcheck="false">
      <div id="palette-results" class="palette-results"></div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>

  <script src="../lib/time.js"></script>
  <script src="../lib/storage.js"></script>
  <script src="tabstash.js"></script>
</body>
</html>
